name: Run SA-MP Server with LocalTunnel

on:
  workflow_dispatch:

jobs:
  run-server:
    runs-on: ubuntu-latest

    steps:
    - name: نصب مخزن
      uses: actions/checkout@v3

    - name: اکسترکت فایل سرور
      run: |
        unzip -o "LexusRP.zip" -d server

    - name: پیدا کردن فایل اجرایی samp03svr
      run: |
        chmod +x ./server/**/samp03svr || chmod +x ./server/**/**/samp03svr
        find ./server -name samp03svr

    - name: نصب NodeJS برای LocalTunnel
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    - name: نصب و اجرای LocalTunnel
      run: |
        npm install -g localtunnel
        lt --port 7777 --subdomain lexusrp > tunnel.log &
        sleep 5
        echo "آدرس تونل ساخته شد:"
        cat tunnel.log

    - name: بروزرسانی آی‌پی در DuckDNS
      run: |
        curl -k "https://www.duckdns.org/update?domains=lexusrp&token=af9e1af2-cc2f-433d-816a-8c75fed13594&ip="

    - name: اجرای سرور SA-MP
      run: |
        cd server/**/** || cd server/** || cd server
        ./samp03svr &
        sleep 10
        echo "سرور اجرا شد"
