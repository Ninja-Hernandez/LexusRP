name: Run SAMP Server via LocalTunnel

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *"

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
    - name: ๐ฅ Clone repo
      uses: actions/checkout@v3

    - name: ๐ฆ Extract ZIP
      run: unzip -o LexusRP.zip -d unpacked

    - name: ๐ ูุตุจ ุงุจุฒุงุฑูุง
      run: |
        sudo apt update
        sudo apt install -y screen wget curl lib32z1 nodejs npm unzip
        npm install -g localtunnel

    - name: โ ุงุฌุฑุง ุณุฑูุฑ SAMP
      run: |
        cd unpacked/LexusRP
        chmod +x samp03svr
        chmod +x announce
        screen -dmS samp ./samp03svr
        sleep 3
        echo "โ ุณุฑูุฑ ุงุฌุฑุง ุดุฏ"

    - name: ๐ ุงุฌุฑุง LocalTunnel ุฑู ูพูุฑุช 7777
      run: |
        lt --port 7777 --subdomain lexusrp > tunnel.log &
        sleep 10
        tail -n 20 tunnel.log

    - name: ๐ฆ ุจูโุฑูุฒุฑุณุงู ุขโูพ ุฏุฑ DuckDNS
      run: |
        curl -s "https://www.duckdns.org/update?domains=lexusrp&token=af9e1af2-cc2f-433d-816a-8c75fed13594&ip="

    - name: ๐ ุจุฑุฑุณ ูพูุฑุช ุณุฑูุฑ
      run: |
        if (echo > /dev/tcp/127.0.0.1/7777) >/dev/null 2>&1; then
          echo "โ ูพูุฑุช 7777 ุจุงุฒู (ุณุฑูุฑ ุฑุงู ุดุฏู)"
        else
          echo "โ๏ธ ูพูุฑุช 7777 ุจุณุชูโุณุช (ุณุฑูุฑ ุฑุงู ูุดุฏู)"
        fi

    - name: ๐ ุจุฑุฑุณ ูุงฺฏ ุณุฑูุฑ
      run: |
        cd unpacked/LexusRP
        if [ -f server.log ]; then
          tail -n 40 server.log
        else
          echo "โ๏ธ ูุงู server.log ุณุงุฎุชู ูุดุฏูุ ุนู ุณุฑูุฑ ููุฑุงู ฺฉุฑุด ฺฉุฑุฏู"
        fi
