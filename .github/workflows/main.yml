name: Run SAMP Server with Ngrok + DuckDNS

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Install dependencies
      run: |
        sudo apt update
        sudo apt install -y unzip curl wget

    - name: Unzip Server Files
      run: unzip -o LexusRP.zip -d LexusRP

    - name: Download ngrok
      run: |
        wget -q https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-stable-linux-amd64.zip
        unzip ngrok-stable-linux-amd64.zip
        chmod +x ngrok

    - name: Add Ngrok Auth Token
      run: ./ngrok config add-authtoken 2zgPZNenzSYjTDNseaBz7BRTbYY_5XDmZur14W15WEoZwgWsp

    - name: Run SAMP Server
      run: |
        chmod +x LexusRP/LexusRP/sampserver/samp03/samp03svr
        cd LexusRP/LexusRP/sampserver/samp03
        nohup ./samp03svr > server.log 2>&1 &

    - name: Run ngrok TCP tunnel
      run: |
        nohup ./ngrok tcp 7777 --region=eu > ngrok.log &
