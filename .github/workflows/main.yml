name: Run SA-MP Server + Debugging (Crash Fix)

on:
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
    - name: ðŸ“¥ Clone repo
      uses: actions/checkout@v3

    - name: ðŸ›  Ù†ØµØ¨ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§
      run: |
        sudo apt update
        sudo apt install -y unzip curl wget nodejs npm lib32z1 lib32ncurses6 screen
        sudo npm install -g localtunnel

    - name: ðŸ“¦ Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙØ§ÛŒÙ„ ZIP
      run: unzip -o LexusRP.zip -d LexusRP

    - name: ðŸ”“ Ø§Ø¬Ø±Ø§ÛŒÛŒ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ samp03svr
      run: |
        chmod +x LexusRP/LexusRP/samp03svr

    - name: ðŸš€ Ø§Ø¬Ø±Ø§ÛŒ Ø³Ø±ÙˆØ± SAMP Ø¯Ø± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
      run: |
        cd LexusRP/LexusRP
        screen -dmS samp ./samp03svr
        sleep 5
        echo "ðŸ“„ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø§Ø¬Ø±Ø§ÛŒ samp03svr:"
        ps aux | grep samp03svr || echo "âŒ Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯Ù‡ ÛŒØ§ Ø³Ø±ÛŒØ¹ Ú©Ø±Ø´ Ú©Ø±Ø¯Ù‡"

    - name: ðŸ”Ž Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø­Ø±Ø§Ù†ÛŒ
      run: |
        echo "ðŸ”¹ Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„ Ø§Ø¬Ø±Ø§ÛŒÛŒ:"
        file LexusRP/LexusRP/samp03svr || echo "â›”ï¸ samp03svr Ù†Ø§Ù‚Øµ ÛŒØ§ Ø®Ø±Ø§Ø¨ Ø§Ø³Øª"
        
        echo "ðŸ”¹ Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„ server.cfg:"
        cat LexusRP/LexusRP/server.cfg || echo "â›”ï¸ server.cfg Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯ ÛŒØ§ Ø®Ø±Ø§Ø¨Ù‡"

        echo "ðŸ”¹ Ø¨Ø±Ø±Ø³ÛŒ pluginÙ‡Ø§:"
        ls -l LexusRP/LexusRP/plugins || echo "â›”ï¸ Ù¾ÙˆØ´Ù‡ plugins Ù†Ø§Ù‚ØµÙ‡ ÛŒØ§ Ø§ØµÙ„Ø§Ù‹ Ù†ÛŒØ³Øª"
        
        echo "ðŸ”¹ Ø¨Ø±Ø±Ø³ÛŒ gamemodes:"
        ls -l LexusRP/LexusRP/gamemodes || echo "â›”ï¸ Ù¾ÙˆØ´Ù‡ gamemodes ÛŒØ§ ÙØ§ÛŒÙ„ AMX Ù†ÛŒØ³Øª"

    - name: ðŸ“„ Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ù…Ù„ Ù„Ø§Ú¯ server.log
      run: |
        echo "ðŸ“„ Ù„Ø§Ú¯ Ú©Ø§Ù…Ù„ Ø§Ø¬Ø±Ø§:"
        cat LexusRP/LexusRP/server.log || echo "â›”ï¸ ÙØ§ÛŒÙ„ server.log Ø³Ø§Ø®ØªÙ‡ Ù†Ø´Ø¯Ù‡ØŒ ÛŒØ¹Ù†ÛŒ Ø³Ø±ÙˆØ± ÙÙˆØ±Ø§Ù‹ Ú©Ø±Ø´ Ú©Ø±Ø¯Ù‡"

    - name: ðŸŒ Ø§Ø¬Ø±Ø§ÛŒ LocalTunnel
      run: |
        npx localtunnel --port 7777 --subdomain lexusrp > tunnel.log &
        sleep 10
        tail -n 20 tunnel.log

    - name: ðŸ¦† Ø¢Ù¾Ø¯ÛŒØª DuckDNS
      run: |
        curl -s "https://www.duckdns.org/update?domains=lexusrp&token=af9e1af2-cc2f-433d-816a-8c75fed13594&ip="

    - name: âœ… Ø¨Ø±Ø±Ø³ÛŒ Ù¾ÙˆØ±Øª Ø³Ø±ÙˆØ±
      run: |
        timeout 5 bash -c "</dev/tcp/127.0.0.1/7777" && echo "âœ… Ù¾ÙˆØ±Øª 7777 Ø¨Ø§Ø²Ù‡ (Ø³Ø±ÙˆØ± Ø±Ø§Ù† Ø´Ø¯Ù‡)" || echo "â›”ï¸ Ù¾ÙˆØ±Øª 7777 Ø¨Ø³ØªÙ‡â€ŒØ³Øª (Ø³Ø±ÙˆØ± Ø±Ø§Ù† Ù†Ø´Ø¯Ù‡)"
