name: Run SA-MP Server - LexusRP

on:
  workflow_dispatch:

jobs:
  start-server:
    runs-on: ubuntu-latest

    steps:
    - name: 📥 کلون کردن فایل‌ها
      uses: actions/checkout@v3

    - name: ⚙️ نصب کتابخانه‌های موردنیاز
      run: |
        sudo apt update
        sudo apt install -y lib32z1 lib32gcc-s1 unzip curl wget

    - name: 📦 استخراج فایل زیپ سرور
      run: |
        unzip -o LexusRP.zip -d LexusRP

    - name: 🔍 بررسی وجود samp03svr و اجرای آن
      run: |
        cd LexusRP/LexusRP
        echo "📁 مسیر فعلی:"
        pwd

        echo "📂 لیست فایل‌ها:"
        ls -la

        if [ -f "samp03svr" ]; then
          echo "✅ samp03svr پیدا شد"
          chmod +x samp03svr
          ./samp03svr > server.log 2>&1 &
          sleep 10

          echo "📄 ۲۰ خط آخر لاگ:"
          tail -n 20 server.log

          if grep -i "started" server.log; then
            echo "✅ سرور با موفقیت اجرا شد!"
          else
            echo "⚠️ سرور اجرا نشد، لطفاً لاگ را بررسی کن"
          fi
        else
          echo "❌ فایل samp03svr پیدا نشد"
          ls -la
          exit 1
        fi
