name: Run SA-MP Server via LocalTunnel

on:
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install -y wget unzip lib32z1 lib32ncurses6 screen
          npm install -g localtunnel

      - name: Make server executable
        run: chmod +x "./LexusRP/samp03svr"

      - name: Run server
        run: |
          cd "./LexusRP"
          screen -dmS samp ./samp03svr

      - name: Start LocalTunnel
        run: |
          npx localtunnel --port 7777 --subdomain lexusrp > tunnel.txt &
          sleep 10
          cat tunnel.txt

      - name: Update DuckDNS
        run: |
          curl -s "https://www.duckdns.org/update?domains=lexusrp&token=af9e1af2-cc2f-433d-816a-8c75fed13594&ip="
