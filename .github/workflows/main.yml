name: Run SA-MP Server via GitHub Actions

on:
  workflow_dispatch:

jobs:
  run-samp-server:
    runs-on: ubuntu-latest

    steps:
      - name: دانلود فایل‌های سرور
        uses: actions/checkout@v3

      - name: نصب Node.js برای LocalTunnel
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: نصب LocalTunnel
        run: npm install -g localtunnel

      - name: اکسترکت فایل ZIP سرور
        run: unzip -o "./LexusRP.zip" -d "./unzipped"

      - name: اجرای دسترسی اجرایی روی samp03svr
        run: chmod +x ./unzipped/LexusRP/file\ server/samp03svr

      - name: اجرای سرور SA-MP
        run: |
          cd ./unzipped/LexusRP/file\ server
          ./samp03svr &

      - name: اجرای LocalTunnel برای پورت 7777
        run: |
          lt --port 7777 --subdomain lexusrp > lt.log &
          sleep 5
          cat lt.log

      - name: بروزرسانی آی‌پی در DuckDNS
        run: |
          curl "https://www.duckdns.org/update?domains=lexusrp&token=af9e1af2-cc2f-433d-816a-8c75fed13594&ip="

      - name: پایان عملیات
        run: echo "سرور SA-MP با موفقیت ران شد ✅"
