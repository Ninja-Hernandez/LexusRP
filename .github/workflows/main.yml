name: Run SA-MP Server via LocalTunnel + DuckDNS

on:
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
    - name: 📥 Clone repo
      uses: actions/checkout@v3

    - name: 🛠 نصب ابزارها
      run: |
        sudo apt update
        sudo apt install -y unzip curl wget nodejs npm lib32z1 lib32ncurses6 screen
        sudo npm install -g localtunnel

    - name: 📦 استخراج فایل ZIP
      run: unzip -o LexusRP.zip -d LexusRP

    - name: 🔓 اجرایی کردن samp03svr
      run: chmod +x LexusRP/samp03svr

    - name: 🚀 اجرای سرور SAMP
      run: |
        cd LexusRP
        screen -dmS samp ./samp03svr

    - name: 🌍 اجرای LocalTunnel
      run: |
        npx localtunnel --port 7777 --subdomain lexusrp > tunnel.log &
        sleep 10
        echo "=== LocalTunnel Log ==="
        tail -n 20 tunnel.log

    - name: 🦆 به‌روزرسانی DuckDNS
      run: |
        curl -s "https://www.duckdns.org/update?domains=lexusrp&token=af9e1af2-cc2f-433d-816a-8c75fed13594&ip="
