name: Run SA-MP Server - LexusRP

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  start-server:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Ú©Ù„ÙˆÙ† Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø§Ø² Ø±ÛŒÙ¾Ùˆ
      uses: actions/checkout@v3

    - name: ğŸ“¦ Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙØ§ÛŒÙ„ LexusRP.zip
      run: unzip -o LexusRP.zip -d LexusRP

    - name: âš™ï¸ Ù†ØµØ¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Û³Û² Ø¨ÛŒØªÛŒ Ù…ÙˆØ±Ø¯Ù†ÛŒØ§Ø²
      run: |
        sudo apt update
        sudo apt install -y lib32z1 lib32gcc-s1

    - name: ğŸ§· Ø¯Ø§Ø¯Ù† Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¬Ø±Ø§ÛŒÛŒ Ø¨Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø³Ø±ÙˆØ±
      run: |
        cd LexusRP/LexusRP
        chmod +x samp03svr || echo "âŒ samp03svr Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯"
        chmod +x announce || echo "âš ï¸ announce Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª"
        chmod +x startup.sh || echo "âš ï¸ startup.sh Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª"

    - name: ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ Ø³Ø±ÙˆØ± SAMP
      run: |
        cd LexusRP/LexusRP
        if [ -f startup.sh ]; then
          ./startup.sh &
        elif [ -f samp03svr ]; then
          ./samp03svr &
        else
          echo "âŒ Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ Ø§Ø¬Ø±Ø§ÛŒÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯"
          exit 1
        fi
        sleep 10
        echo "âœ… Ø³Ø±ÙˆØ± Ø§Ø¬Ø±Ø§ Ø´Ø¯ - Ø¢Ø¯Ø±Ø³: LexusRP.DuckDNS.org:7777"

    - name: ğŸ“„ Ù„Ø§Ú¯ Ø¨Ø±Ø±Ø³ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
      run: |
        cd LexusRP/LexusRP
        if [ -f server.log ]; then
          echo "ğŸ“œ Ù„Ø§Ú¯ Ø³Ø±ÙˆØ±:"
          tail -n 30 server.log
        else
          echo "âš ï¸ ÙØ§ÛŒÙ„ Ù„Ø§Ú¯ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯"
        fi
