name: Run SAMP Server

on:
  workflow_dispatch:
  push:

jobs:
  run-server:
    runs-on: ubuntu-latest

    steps:
    - name: üì• Clone Repository
      uses: actions/checkout@v3

    - name: üõ† Install Dependencies
      run: |
        sudo apt update
        sudo apt install -y unzip curl wget nodejs npm
        sudo npm install -g localtunnel

    - name: üì¶ Extract Server Files
      run: unzip -o LexusRP_Final.zip -d LexusRP

    - name: üåê Update DuckDNS IP
      run: |
        mkdir -p ~/duckdns
        echo "url=https://www.duckdns.org/update?domains=lexusrp&token=af9e1af2-cc2f-433d-816a-8c75fed13594&ip=" > ~/duckdns/duck.conf
        curl -k -o ~/duckdns/duck.log -K ~/duckdns/duck.conf

    - name: üöá Start LocalTunnel
      run: |
        lt --port 7777 --subdomain lexusrp > tunnel.log &
        sleep 10
        tail -n 20 tunnel.log

    - name: üîß Make Executables
      run: |
        chmod -R +x LexusRP/LexusRP
        chmod +x LexusRP/LexusRP/samp03svr
        chmod +x LexusRP/LexusRP/announce || echo "‚ö†Ô∏è No announce file"

    - name: üöÄ Run Server
      run: |
        cd LexusRP/LexusRP
        nohup ./samp03svr > server.log 2>&1 &
        sleep 5
        tail -n 40 server.log || echo "‚ö†Ô∏è Log not found"

    - name: ‚úÖ Done
      run: |
        echo "Server started (if all logs are OK)"
        echo "Access via: LexusRP.DuckDNS.org:7777 or lexusrp.loca.lt:7777"
