name: Run SAMP Server with LocalTunnel + DuckDNS

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *"  # ูุฑ 6 ุณุงุนุช ุงุฌุฑุง ูุดู

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ๐ฅ ฺฉููู ฺฉุฑุฏู ูุฎุฒู
      uses: actions/checkout@v3

    - name: ๐ ูุตุจ ุงุจุฒุงุฑูุง
      run: |
        sudo apt update -qq
        sudo apt install -y unzip curl wget nodejs npm > /dev/null
        sudo npm install -g localtunnel > /dev/null

    - name: ๐ฆ ุงุณุชุฎุฑุงุฌ ูุงู ZIP
      run: unzip -o LexusRP.zip -d LexusRP

    - name: ๐ ุจูโุฑูุฒุฑุณุงู IP DuckDNS
      run: |
        mkdir -p ~/duckdns
        echo "url=https://www.duckdns.org/update?domains=lexusrp&token=af9e1af2-cc2f-433d-816a-8c75fed13594&ip=" > ~/duckdns/duck.conf
        curl -k -s -o ~/duckdns/duck.log -K ~/duckdns/duck.conf
        echo "DuckDNS Response:"
        tail -n 10 ~/duckdns/duck.log

    - name: ๐ ุงุฌุฑุง LocalTunnel ุจุง ุฒุฑุฏุงููู lexusrp
      run: |
        lt --port 7777 --subdomain lexusrp > tunnel.log 2>&1 &
        sleep 8
        echo "LocalTunnel Log (ุขุฎุฑู 20 ุฎุท):"
        tail -n 20 tunnel.log

    - name: ๐ ุจุฑุฑุณ ูุงูโูุง ุญุงุช ู ูุฌูุฒูุง
      run: |
        if [ -f LexusRP/LexusRP/samp03svr ]; then
          chmod +x LexusRP/LexusRP/samp03svr
          echo "โ ูุงู samp03svr ูพุฏุง ุดุฏ ู ูพุฑูุดู ุงุฌุฑุง ุฏุงุฏู ุดุฏ."
        else
          echo "โ ุฎุทุง: ูุงู samp03svr ูพุฏุง ูุดุฏ."
          exit 1
        fi

        echo "๐ ูุญุชูุงุช ูพูุดู Plugins:"
        ls -l LexusRP/LexusRP/plugins || echo "โ ูพูุดู Plugins ูพุฏุง ูุดุฏ!"
        
        echo "๐ ูุญุชูุงุช ูพูุดู Gamemodes:"
        ls -l LexusRP/LexusRP/gamemodes || echo "โ ูพูุดู Gamemodes ูพุฏุง ูุดุฏ!"

    - name: ๐ ุงุฌุฑุง ุณุฑูุฑ SAMP
      run: |
        cd LexusRP/LexusRP
        nohup ./samp03svr > server.log 2>&1 &
        sleep 6

        echo "๐ ููุงุด ูุงฺฏ ุณุฑูุฑ (ุขุฎุฑู 40 ุฎุท):"
        tail -n 40 server.log

        echo "๐ ุจุฑุฑุณ ูุงฺฏ ุจุฑุง ูุดฺฉูุงุช ุงุญุชูุงู:"
        grep -i "error" server.log && echo "โ ุฎุทุง ุฏุฑ ูุงฺฏ ุณุฑูุฑ ุงูุช ุดุฏ!" || echo "โ๏ธ ุฎุทุง ุฏุฑ ูุงฺฏ ุณุฑูุฑ ุงูุช ูุดุฏ."
        grep -i "plugin" server.log || echo "โ๏ธ ูพูุงฺฏูโูุง ุจุฏูู ูุดฺฉู ุจุงุฑฺฏุฐุงุฑ ุดุฏูุฏ."
        grep -i "gamemode" server.log || echo "โ๏ธ ฺฏูโููุฏ ุจุฏูู ูุดฺฉู ุจุงุฑฺฏุฐุงุฑ ุดุฏ."
        grep -i "started" server.log || echo "โ๏ธ ุงุญุชูุงูุงู ุณุฑูุฑ ฺฉุงูู ุฑุงู ูุดุฏู."

    - name: โ ูุชุฌู ููุง ู ุขุฏุฑุณ ุณุฑูุฑ
      run: |
        echo "โ ุณุฑูุฑ ุจุง ููููุช ุงุฌุฑุง ุดุฏู ุจุงุดุฏุ ุงุฒ ุทุฑู ุขุฏุฑุณ ุฒุฑ ูุงุฑุฏ ุดูุฏ:"
        echo "๐ IP ุซุงุจุช ู ุขุฏุฑุณ ุณุฑูุฑ: LexusRP.Duckdns.org:7777"
