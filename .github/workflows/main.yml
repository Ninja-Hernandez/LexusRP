name: Run SA-MP Server via LocalTunnel + DuckDNS

on:
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
    - name: ðŸ“¥ Clone repo
      uses: actions/checkout@v3

    - name: ðŸ›  Ù†ØµØ¨ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§
      run: |
        sudo apt update
        sudo apt install -y unzip curl wget nodejs npm lib32z1 lib32ncurses6 screen
        sudo npm install -g localtunnel

    - name: ðŸ“¦ Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙØ§ÛŒÙ„ ZIP
      run: unzip -o LexusRP.zip -d LexusRP

    - name: ðŸ”“ Ø§Ø¬Ø±Ø§ÛŒÛŒ Ú©Ø±Ø¯Ù† samp03svr
      run: chmod +x LexusRP/samp03svr

    - name: ðŸš€ Ø§Ø¬Ø±Ø§ÛŒ Ø³Ø±ÙˆØ± SAMP
      run: |
        cd LexusRP
        screen -dmS samp ./samp03svr

    - name: ðŸŒ Ø§Ø¬Ø±Ø§ÛŒ LocalTunnel
      run: |
        npx localtunnel --port 7777 --subdomain lexusrp > tunnel.log &
        sleep 10
        echo "=== LocalTunnel Log ==="
        tail -n 20 tunnel.log

    - name: ðŸ¦† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ DuckDNS
      run: |
        curl -s "https://www.duckdns.org/update?domains=lexusrp&token=af9e1af2-cc2f-433d-816a-8c75fed13594&ip="
