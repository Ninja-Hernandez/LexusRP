name: Run SAMP Server with DuckDNS + Auto Restart + Manual

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install Dependencies
        run: |
          sudo apt update
          sudo apt install -y unzip curl lib32gcc-s1

      - name: Unzip Server Files
        run: unzip -o LexusRP.zip -d LexusRP

      - name: Make Server Executable
        run: chmod +x LexusRP/LexusRP/sampserver/samp03/samp03svr

      - name: Update DuckDNS IP
        run: |
          mkdir -p $HOME/duckdns
          echo 'url=https://www.duckdns.org/update?domains=lexusrp&token=af9e1af2-cc2f-433d-816a-8c75fed13594&ip=' > $HOME/duckdns/duck.conf
          curl -k -o $HOME/duckdns/duck.log -K $HOME/duckdns/duck.conf

      - name: Run SAMP Server
        run: |
          cd LexusRP/LexusRP/sampserver/samp03
          nohup ./samp03svr > server.log 2>&1 &
          sleep 5

      - name: Finish
        run: echo 'âœ… All done. Connect to: lexusrp.duckdns.org:7777'
