name: Run SAMP Server with DuckDNS

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *"  # هر 6 ساعت اجرا میشه

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: نصب ابزارهای موردنیاز
        run: sudo apt update && sudo apt install -y unzip curl

      - name: استخراج فایل‌ها
        run: unzip -o LexusRP.zip

      - name: آپدیت آی‌پی DuckDNS
        run: |
          curl -k "https://www.duckdns.org/update?domains=lexusrp&token=af9e1af2-cc2f-433d-816a-8c75fed13594&ip="

      - name: اجرای سرور SAMP و ذخیره لاگ
        run: |
          chmod +x LexusRP/LexusRP/sampserver/samp03/samp03svr
          cd LexusRP/LexusRP/sampserver/samp03
          nohup ./samp03svr > server.log 2>&1 &

      - name: نمایش لاگ‌های سرور (آخرین 50 خط)
        run: tail -n 50 LexusRP/LexusRP/sampserver/samp03/server.log

      - name: سرور راه‌اندازی شد
        run: echo "✅ سرور روی lexusrp.duckdns.org:7777 اجرا شد"
