name: Run SA-MP Server

on:
  workflow_dispatch:

jobs:
  run-server:
    runs-on: ubuntu-latest

    steps:
    - name: نصب پکیج‌های ضروری
      run: sudo apt update && sudo apt install unzip screen wget -y

    - name: دانلود و اکسترکت فایل سرور
      run: |
        wget https://github.com/Ninja-Hernandez/LexusRP/raw/main/LexusRP.zip -O server.zip
        unzip server.zip -d server

    - name: اجرای سرور
      run: |
        chmod +x ./server/samp03svr
        screen -dmS samp ./server/samp03svr

    - name: نصب NodeJS برای LocalTunnel
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    - name: نصب و اجرای LocalTunnel
      run: |
        npm install -g localtunnel
        lt --port 7777 --subdomain lexusrp > tunnel.log &
        sleep 10
        cat tunnel.log

    - name: بروزرسانی آی‌پی در DuckDNS
      run: |
        curl "https://www.duckdns.org/update?domains=lexusrp&token=af9e1af2-cc2f-433d-816a-8c75fed13594&ip="
