name: Run SAMP Server with LocalTunnel + DuckDNS + Debug

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ๐ฅ ฺฉููู ฺฉุฑุฏู ุฑูพุงุฒุชูุฑ
      uses: actions/checkout@v3

    - name: ๐ ูุตุจ ุงุจุฒุงุฑูุง ููุฑุฏูุงุฒ
      run: |
        sudo apt update
        sudo apt install -y unzip curl wget nodejs npm
        sudo npm install -g localtunnel

    - name: ๐ฆ ุงุณุชุฎุฑุงุฌ ูุงูโูุง ุณุฑูุฑ
      run: unzip -o LexusRP.zip -d LexusRP

    - name: ๐ ุจูโุฑูุฒุฑุณุงู IP ุฏุฑ DuckDNS
      run: |
        mkdir -p ~/duckdns
        echo "url=https://www.duckdns.org/update?domains=lexusrp&token=af9e1af2-cc2f-433d-816a-8c75fed13594&ip=" > ~/duckdns/duck.conf
        curl -k -o ~/duckdns/duck.log -K ~/duckdns/duck.conf

    - name: ๐ ุงุฌุฑุง LocalTunnel ุฑู ูพูุฑุช 7777
      run: |
        lt --port 7777 --subdomain lexusrp > tunnel.log &
        sleep 10
        tail -n 20 tunnel.log

    - name: โ ุชูุธู ูุฌูุฒ ูุงูโูุง ุงุฌุฑุง
      run: |
        chmod -R +x LexusRP/LexusRP

    - name: ๐ ุงุฌุฑุง ุณุฑูุฑ SAMP
      run: |
        cd LexusRP/LexusRP
        nohup ./samp03svr > server.log 2>&1 &
        sleep 8
        echo "๐ ูุงฺฏ ฺฉุงูู:"
        cat server.log

        echo "๐ ุจุฑุฑุณ ุฎุทุงูุง:"
        grep -i "error" server.log || echo "โ ุฎุทุง ุจุง ฺฉููู 'error' ุงูุช ูุดุฏ"
        grep -i "plugin" server.log || echo "โ ูุดฺฉู ุฏุฑ ุจุงุฑฺฏุฐุงุฑ plugin ุฏุฏู ูุดุฏ"
        grep -i "gamemode" server.log || echo "โ ูุดฺฉู ุฏุฑ gamemode ุฏุฏู ูุดุฏ"

        echo "๐ ูุญุชูุงุช gamemodes ู plugins:"
        ls -l gamemodes/
        ls -l plugins/

        echo "๐ง ุงฺฏุฑ ฺฉุฑุด ุดุฏุ ุจุฑุฑุณ ฺฉู:"
        echo "๐ .amx ุฎุฑุงุจ ุง ูุงูุต"
        echo "๐ ูพูุงฺฏูโูุง ููุฏูุฒ (.dll) ุฑู ูููฺฉุณ ุฌูุงุจ ููโุฏู"
        echo "๐ ูุงู announce ููฺฉูู ุงุฌุฑุง ูุจุงุดู ุง ุฎุฑุงุจ ุจุงุดู"

    - name: โ ุขุฏุฑุณ ููุง
      run: |
        echo "โ ุงฺฏุฑ ููู ฺุฒ ุฏุฑุณุช ุจูุฏุ ุงุฒ ุขุฏุฑุณโูุง ุฒุฑ ูุงุฑุฏ ุดู:"
        echo "๐ LexusRP.DuckDNS.org:7777"
        echo "๐ lexusrp.loca.lt:7777"
