name: Run SA-MP Server (Fast + Debug) with LocalTunnel + DuckDNS

on:
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Clone repo
      uses: actions/checkout@v3

    - name: ğŸ›  Ù†ØµØ¨ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§
      run: |
        sudo apt update
        sudo apt install -y unzip curl wget nodejs npm lib32z1 lib32ncurses6 screen
        sudo npm install -g localtunnel

    - name: ğŸ“¦ Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙØ§ÛŒÙ„ ZIP
      run: unzip -o LexusRP.zip -d LexusRP

    - name: ğŸ”“ Ø§Ø¬Ø±Ø§ÛŒÛŒ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ samp03svr
      run: |
        chmod +x LexusRP/LexusRP/samp03svr

    - name: ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ Ø³Ø±ÛŒØ¹ Ø³Ø±ÙˆØ± SAMP
      run: |
        cd LexusRP/LexusRP/
        screen -dmS samp ./samp03svr
        sleep 5
        echo "ğŸ“„ Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø±ÙˆØ±:"
        ps aux | grep samp03svr || echo "â›”ï¸ samp03svr Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯Ù‡!"
        echo "ğŸ“„ Ù„Ø§Ú¯ Ø¢Ø®Ø± Ø³Ø±ÙˆØ±:"
        tail -n 40 server.log || echo "server.log Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯"

    - name: ğŸŒ Ø§Ø¬Ø±Ø§ÛŒ LocalTunnel Ø¨Ø±Ø§ÛŒ Ù¾ÙˆØ±Øª 7777
      run: |
        npx localtunnel --port 7777 --subdomain lexusrp > tunnel.log &
        sleep 10
        echo "ğŸ“„ Ù„Ø§Ú¯ LocalTunnel (Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø§ØªØµØ§Ù„):"
        tail -n 20 tunnel.log

    - name: ğŸ¦† Ø¢Ù¾Ø¯ÛŒØª Ø¢ÛŒâ€ŒÙ¾ÛŒ DuckDNS
      run: |
        curl -s "https://www.duckdns.org/update?domains=lexusrp&token=af9e1af2-cc2f-433d-816a-8c75fed13594&ip="

    - name: ğŸ” ØªØ³Øª ÙˆØ¶Ø¹ÛŒØª Ø³Ø±ÙˆØ± (Ø¨Ø±Ø§ÛŒ Ø±ÙØ¹ Ù…Ø´Ú©Ù„ Loading)
      run: |
        echo "ğŸ§ª Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø³Ø±ÙˆØ± Ø¯Ø± Ù¾ÙˆØ±Øª 7777:"
        timeout 5 bash -c "</dev/tcp/127.0.0.1/7777" && echo "âœ… Ù¾ÙˆØ±Øª 7777 Ø¨Ø§Ø²Ù‡ (Ø³Ø±ÙˆØ± Ø±Ø§Ù† Ø´Ø¯Ù‡)" || echo "â›”ï¸ Ù¾ÙˆØ±Øª 7777 Ø¨Ø³ØªÙ‡â€ŒØ³Øª (Ø³Ø±ÙˆØ± Ø±Ø§Ù† Ù†Ø´Ø¯Ù‡)"
        echo "ğŸš€ Ø§Ú¯Ø± Ù¾ÙˆØ±Øª Ø¨Ø§Ø² Ø¨ÙˆØ¯ ÙˆÙ„ÛŒ Ù‡Ù†ÙˆØ² Ø¯Ø± SAMP Ù†ÙˆØ´ØªÙ‡ LOADING:"
        echo "ğŸ”¹ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù† gamemode Ùˆ plugin Ø¯Ø±Ø³Øª Ù„ÙˆØ¯ Ø´Ø¯Ù†ØŸ"
        echo "ğŸ”¹ Ø³Ø±ÙˆØ± Ø¨Ø§ localtunnel Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù…ØªØµÙ„ Ø´Ø¯Ù‡ØŸ"
        echo "ğŸ”¹ ÙØ§ÛŒØ±ÙˆØ§Ù„ ÛŒØ§ Ø§Ø±ÙˆØ± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¨Ø§Ø¹Ø« Ú©Ø±Ø´ Ù†Ø´Ø¯Ù‡ØŸ"
