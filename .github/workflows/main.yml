name: Start SAMP Server via LocalTunnel

on: workflow_dispatch: schedule: - cron: '0 */6 * * *'

jobs: run-samp-server: runs-on: ubuntu-latest timeout-minutes: 120

steps:
  - name: Checkout
    uses: actions/checkout@v3

  - name: Install Dependencies
    run: |
      sudo apt update && sudo apt install -y unzip screen wget lib32z1

  - name: Download LocalTunnel & Start Tunnel
    run: |
      npm install -g localtunnel
      lt --port 7777 --subdomain lexusrp > ltlog.txt &
      sleep 5
      echo 'LocalTunnel started.'

  - name: Update DuckDNS
    run: |
      curl -s "https://www.duckdns.org/update?domains=lexusrp&token=af9e1af2-cc2f-433d-816a-8c75fed13594&ip="

  - name: Unzip Server Files
    run: |
      unzip LexusRP.zip
      cd LexusRP && chmod +x samp03svr && chmod +x announce

  - name: Run Server
    run: |
      cd LexusRP
      screen -dmS samp ./samp03svr
      echo 'Server started.'

  - name: Wait & Show Tunnel Info
    run: |
      sleep 20
      cat ltlog.txt || echo 'Tunnel log not found.'

