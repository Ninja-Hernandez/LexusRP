name: Run SAMP Server with LocalTunnel + DuckDNS

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ๐ฅ ฺฉููู ฺฉุฑุฏู ูุฎุฒู
      uses: actions/checkout@v3

    - name: ๐ ูุตุจ ุงุจุฒุงุฑูุง ูุงุฒู
      run: |
        sudo apt update
        sudo apt install unzip curl net-tools -y
        npm install -g localtunnel

    - name: ๐ฆ ุจุงุฒ ฺฉุฑุฏู ูุงู ูุดุฑุฏู ุณุฑูุฑ
      run: |
        unzip -o "LexusRP.zip" -d .
        chmod -R +x LexusRP/LexusRP

    - name: ๐ ุจูโุฑูุฒุฑุณุงู ุขโูพ DuckDNS
      run: |
        mkdir -p ~/duckdns
        echo "url=https://www.duckdns.org/update?domains=lexusrp&token=af9e1af2-cc2f-433d-816a-8c75fed13594&ip=" > ~/duckdns/update.sh
        chmod +x ~/duckdns/update.sh
        ~/duckdns/update.sh

    - name: ๐ ุงุฌุฑุง LocalTunnel ุฑู ูพูุฑุช 7777
      run: |
        lt --port 7777 --subdomain lexusrp > tunnel.log &
        sleep 10

    - name: ๐งท ุฏุณุชุฑุณ ุงุฌุฑุง ุจู ูุงูโูุง ุณุฑูุฑ
      run: chmod -R +x LexusRP/LexusRP

    - name: ๐ ุงุฌุฑุง ุณุฑูุฑ SAMP
      run: |
        cd LexusRP/LexusRP
        ./samp03svr > full.log &
        sleep 10
        echo "๐ ูุงฺฏ ุณุฑูุฑ (ฺฉุงูู):"
        cat full.log || echo "โ๏ธ ูุงู ูุงฺฏ ูพุฏุง ูุดุฏ"
        echo "๐ ุจุฑุฑุณ ูุดฺฉูุงุช:"
        grep -i "error\|unknown\|plugin\|File\|not found\|Script" full.log || echo "โ๏ธ ูฺ ุงุฑูุฑ ุฏุฑ ูุงฺฏ ูพุฏุง ูุดุฏ."
        if ! pgrep -x "samp03svr" > /dev/null; then
          echo "โ๏ธ ุณุฑูุฑ ุจูโุทูุฑ ฺฉุงูู ุฑุงู ูุดุฏู ุงุณุช"
        else
          echo "โ ุณุฑูุฑ ุฏุฑ ุญุงู ุงุฌุฑุงุณุช"
        fi

    - name: โ ุงฺฏุฑ ููู ฺุฒ ุฏุฑุณุช ุจูุฏุ ุงุฒ ุขุฏุฑุณโูุง ุฒุฑ ูุงุฑุฏ ุดู:
      run: |
        echo "๐ LexusRP.DuckDNS.org:7777"
        echo "๐ lexusrp.loca.lt:7777"
